<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Callback</title>
</head>
<body>
  <script>
      const params = new Proxy(new URLSearchParams(window.location.search), {get: (searchParams, prop) => searchParams.get(prop),});

      const Http = new XMLHttpRequest();
      Http.open('POST', "https://login.eveonline.com/v2/oauth/token");
      Http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
      Http.send(new URLSearchParams({
          'grant_type': 'authorization_code',
          'code': params.code,
          'client_id': "d513b498c32048179f0b32c011d03f30",
          'code_verifier': window.sessionStorage.getItem("verifier")
      }));
      
      Http.onreadystatechange = (e) => {
          const token = JSON.parse(Http.responseText)
          window.sessionStorage.setItem('access_token', token.access_token);
          window.sessionStorage.setItem('expires_at', Date.now() + token.expires_in);
          window.sessionStorage.setItem('refresh_token', token.refresh_token);
          window.sessionStorage.setItem('token_type', token.token_type);
          window.sessionStorage.removeItem('verifier')
          window.location.replace('http://localhost');
      }
  </script>
</body>
</html>